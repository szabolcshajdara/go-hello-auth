<!DOCTYPE html>
<html>
<body>
    <h1>Cloud Function Auth Demo</h1>
    <button onclick="getToken()">1. Login & Authorize</button>
    <button onclick="callFunction()">2. Call Secure Function</button>
    
    <p id="status">Status: Not logged in</p>
    <pre id="output"></pre>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        let client;
        let access_token;

        // Initialize the Identity client
        window.onload = function () {
            client = google.accounts.oauth2.initTokenClient({
                client_id: 'YOUR_CLIENT_ID.apps.googleusercontent.com',
                scope: 'openid email profile', // Scopes needed to identify the user
                callback: (tokenResponse) => {
                    access_token = tokenResponse.access_token;
                    document.getElementById('status').innerText = "Status: Authenticated!";
                },
            });
        };

        function getToken() {
            client.requestAccessToken();
        }

        async function callFunction() {
            if (!access_token) {
                alert("Please login first!");
                return;
            }

            try {
                const response = await fetch('https://YOUR_FUNCTION_URL.run.app', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${access_token}`
                    }
                });
                
                const text = await response.text();
                document.getElementById('output').innerText = text;
            } catch (err) {
                document.getElementById('output').innerText = "Error: " + err;
            }
        }
    </script>
</body>
</html>
